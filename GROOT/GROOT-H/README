%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                 GROOT-H                  %%
%%    GRaphics for OSEs and OSSEs on TCs    %%
%%           Hurricane Component            %%
%%    CREATED BY: DR. SARAH D. DITCHEK      %%
%%  If using this graphics package, please  %%
%%   acknowledge that graphics were made    %%
%%    using GROOT by citing the GitHub      %%
%%   repository. An additional shoutout     %%
%% to Dr. Sarah D. Ditchek from CIMAS/AOML  %%
%%         is always appreciated :)         %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%
%% SUMMARY %%
%%%%%%%%%%%%%

THIS DIRECTORY CONTAINS A VISUALIZATION PACKAGE FOR OBSERVING SYSTEM EXPERIMENTS (OSES) AND OBSERVING SYSTEM SIMULATION EXPERIMENTS (OSSES) THAT USE HWRF OR THE BASIN-SCALE HWRF. 
THE MAIN CAPABILITIES OF THIS GRAPHICS PACKAGE ARE TO GENERATE:
  1) ERROR STATISTICS (E.G., ERRORS/IMPROVEMENT/BIAS/FSP OF TRACK, INTENSITY, PRESSURE, TC SIZE)
  2) ASSIMILATED OBSERVATION GRAPHICS (I.E., THE EARTH-RELATIVE AND STORM-RELATIVE LOCATION OF THE OBSERVATION TYPE YOU ARE TESTING) 
  3) STORM-CENTERED DIFFERENCES OF ANY FIELD OUTPUTTED BY THE MODEL
MOST IMPORTANTLY, THIS PACKAGE CAN BE USED FOR OSES/OSSES WITH ANY NUMBER OF EXPERIMENTS, WITH USER INPUT BEING CONFINED TO A BRIEF NAMELIST - EVERYTHING ELSE IS AUTOMATED.

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FILES AND DIRECTORIES %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%

INITIALLY INCLUDED IN PACKAGE:

README 	          | this file that explains what this visualization package is along with a description of the files and directories included and how to run the package
editgrb.m   	  | this script is the "namelist" - it is the only script that needs to be edited to run the grb capability for one storm at a time
rungrb.ksh        | this is the script that you will submit via batch which runs the grb capability
editverif.m       | this script is the "namelist" - it is the only script that needs to be edited to run verification capability
runverif.ksh      | this is the script that you will submit via batch which runs the verification capability
bdeck/		  | folder that contains the bdecks for TCs from 2016-2019
nctoolbox-1.1.3/  | folder that allows for matlab to read the grb files
retrievalscripts/ | folder that contains all scripts to retrieve files for package to run
  README              | this file explains how to edit and compile the the gsi scripts and how to run the retrieval script
  gsi_diag_conv.f90   | this is the file you'd edit if you wanted to retrieve gsidiag files
  gsi_diag_rad.x      | this executable reads radiances from gsidiag files
  iscyclecomplete.ksh | this file produces text files telling you and the retrieval script which cycles are completed
  rtrv_conv_tmplt.sh  | this script retrieves the needed files (including conv obs) for the package to run and puts them in the proper directory structure (as if scrubbing was turned off).
  rtrv_rad_tmplt.sh   | this script retrieves the needed files (including radiances) for the package to run and puts them in the proper directory structure (as if scrubbing was turned off).
  RAD/ 		      | folder with file needed to run gsi_diag_rad.x (namelist.rad) and files needed to grab qc flags for satellite obs (.pro scripts)
  HWRFDA.ksh          | this script (and crontab line within script) will retrieve pre-GSI and post-GSI grids while running the model before being scrubbed and put them in a separate folder
scripts/ 	  | folder that contains all scripts needed to run the package
  arrow3.m 	      | script that allows for vertical wind shear direction to be plotted
  atcf.m 	      | function that reads the atcf files and formats them to be on one line per forecast hour
  borders.shp         | shapefile to make country borders
  borders.shx         | shapefile to make country borders
  confplot.m 	      | function that calculates the 95% confidence interval
  customcolorbars.m   | script that creates the colorbars used
  custommap.m 	      | function that creates a balanced colormap with a specific number of colors given one color
  customvariables.m   | script that identifies properties related to variables outputted by HWRF and the basin-scale HWRF (e.g., name, units, min/max bounds)
  matlab*graphics.ksh | this script generates copies of the matlab*batch script based on how many cycles need to be run - allows for submission of multiple jobs, one at a time
  matlab*batch.ksh    | this script generates mat files for each variable and generates graphics - uses 40 cores (1 node) and opens X matlab instances (X = # of variables the user requests)
  matlab*clean.ksh    | this script removes the duplicate matlab*batch_ files
  matlabverif* 	      | scripts related to running the verification capability
  rungrb.m	      | grb capability script
  runverif.m	      | verification capability script
  ttestsc.m           | function that incorporates serial correlation time of 12 h in the ttest calculation (as per Sim Aberson)
  windbarbm.m         | function to generate wind barbs (note that flags are currently not filled)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% HOW TO RUN THE PACKAGE %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

VERIFICATION CAPABILITY - THIS GIVES FULL-STORM GRAPHICS AND GRAPHICS THAT ARE CONSISTENT WITH NHC VERIFICATION - VARIOUS STRATIFICATIONS OF YOUR SAMPLE ARE ALSO TAKEN.
1) If you had scrubbing turned ON, first run the retrieval script to download the files needed by the package. This is in the retrievalscripts/ directory. Read the README first.
2) Edit the user settings section of editverif.m for the cases you want to include
3) Edit the user settings section of runverif.ksh - follow the instructions carefully or it won't run
4) Load the matlab module (module load matlab) - this isn't included in the batch scripts in case there is an issue/conflict with your other loaded modules
5) Submit runverif.ksh to batch: sbatch ./runverif.ksh

STORM-CENTERED GRAPHICS CAPABILITY - YOU MUST WAIT UNTIL THE ENTIRE STORM HAS FINISHED TO RUN THIS CAPABILITY.
1) If you had scrubbing turned ON, first run the retrieval script to download the files needed by the package. This is in the retrievalscripts/ directory. Read the README first.
2) Edit the user settings section of editgrb.m for the one storm you're running this capability for
3) Edit the user settings section of rungrb.ksh - follow the instructions carefully or it won't run
4) Load the matlab module (module load matlab) - this isn't included in the batch scripts in case there is an issue/conflict with your other loaded modules
5) Submit rungrb.ksh to batch: sbatch ./rungrb.ksh

THAT'S IT!!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% LOCATION AND DESCRIPTION OF VARIOUS RESULTS %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

RESULTS ARE LOCATED IN THE PACKAGE'S RESULTS DIRECTORY IN A FOLDER NAMED AFTER YOUR EXPERIMENTS [EXP1_EXPN]. THE BELOW DIRECTORY STRUCTURE DETAILS THE FOLDERS AND CONTENTS OF [EXP1_EXPN] BASED ON WHETHER YOU RAN THE VERIFICATION OR GRB CAPABILITY.

VERIFICATION CAPABILITY: 
[VERIFICATION]/				 | all of the runverif.ksh results are in this folder
[VERIFICATION]/InvestN/			 | results consistent with NHC verification (t=0 and t=x are TD,TS,HU,SD,SS); for storms included in stratifications, see created text files
[VERIFICATION]/InvestN/[BASIN]/          | results for a single basin are in here - there will be .png files for composite graphics and folder for each storm (NAMEYY)
[VERIFICATION]/InvestN/[BASIN]/[NAMEYY]  | results for a single storm are in here - this included errors statistics for a single storm and .mat files
[VERIFICATION]/OBS/              	 | .mat files and graphics of conventional or satellite observations assimilated are in here

GRB CAPABILITY: 
[NAMEYY]/          			 | .mat files of chosen, visualized variables are saved here for future compositing
[NAMEYY]/HWRFDA/                         | all the HWRFDA graphics are located in here
[NAMEYY]/TRACKINT/ 			 | all the error-statistics graphics are located in here
[NAMEYY]/FIELDS/DIFFSTORM 		 | all the storm-grid storm-centered difference graphics are located here
[NAMEYY]/FIELDS/DIFFSYNOPTIC 		 | all the synoptic-grid storm-centered difference graphics are located here
[NAMEYY]/FIELDS/[EXP#]/MATFILES/	 | all the script-generated .mat files for each variable will be located in here before being automatically deleted after graphical output
[NAMEYY]/FIELDS/[EXP#]/FIGURES/		 | all the synoptic-grid, 200-850 hPa, 200-800 km annulus vertical wind shear graphics are located here
[NAMEYY]/FIELDS/[EXP#]/FIGURES/STORM/	 | all the storm-grid storm-centered graphics are located here
[NAMEYY]/FIELDS/[EXP#]/FIGURES/SYNOPTIC/ | all the synoptic-grid storm-centered graphics are located here

%%%%%%%%%%%%%%%%%%
%%  KEY POINTS  %%
%%%%%%%%%%%%%%%%%%

VERIFICATION CAPABILITY:
1) Significance is displayed on error-statistic graphics as squares (95%) and circles (90%) wrt the identexpsigimp - this detail is not included on the graphics in order to save space.
2) Every time you run this capability, if you ran the capability for the same set of experiments previously, those results are deleted. This is to ensure that your results include the most up-to-date data.

GRB CAPABILITY:
1) Only the SYNOPTIC and STORM grids are used for the grb capability. 
      A) The SYNOPTIC grid covers the same domain as the GLOBAL grid, but has a higher resolution than the GLOBAL grid.
      B) The STORM grid has the same resolution as the CORE grid, but has a larger domain than the CORE grid.
2) In the HWRFDA section, since the output of the pre-GSI and post-GSI grids are on hybrid levels, plan-view graphics and azimuthally-averaged graphics are taken at the average pressure over ocean in the entire domain at each level. This caveat is not written on graphics to save space, but an asterik is included next to the word "Pressure" so that a note can be included in a caption or on a slide.

%%%%%%%%%%%%%%%%%%%%%%
%%  NEW ADDITIONS!  %%
%%     02/09/21     %%
%%%%%%%%%%%%%%%%%%%%%%

02/09/21 | Package v1.0.0 ready for distribution to OSA!

%%%%%%%%%%%%%
%% ISSUES? %%
%%%%%%%%%%%%%

Contact sarah.d.ditchek@noaa.gov if you encounter any issues :)
